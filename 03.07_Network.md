# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

### 1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?
*Ответ:*  
В Linux используются команды:
- `ifconfig -a`
- `ip link show` - наиблее актуальный способ
- `ls /sys/class/net`
- `cat /proc/net/dev`
- `netstat -i`
```shel
vagrant@vagrant:~$ ip link show
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 08:00:27:b1:28:5d brd ff:ff:ff:ff:ff:ff
```

В Windows:
- Панель управления\Сеть и Интернет\Центр управления сетями и общим доступом
- `netsh interface show interface`
- `ipconfig /all` - наиблее актуальный способ
- `Get-NetIPConfiguration -Detailed -All`

```shell
PS C:\Users\rusla> netsh interface show interface

Состояние адм.  Состояние     Тип              Имя интерфейса
---------------------------------------------------------------------
Разрешен       Отключен       Выделенный       Беспроводная сеть
Разрешен       Подключен      Выделенный       VirtualBox Host-Only Network
Разрешен       Отключен       Выделенный       Ethernet 3
Запрещен       Отключен       Выделенный       Ethernet 4
Разрешен       Подключен      Выделенный       Ethernet 5
Разрешен       Подключен      Выделенный       Подключение по локальной сети* 10
Запрещен       Отключен       Выделенный       Ethernet
```

### 2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?
*Ответ:*  
LLDP (Link Layer Discovery Protocol) - свободно распространяемый протокол, пришедший на смену проприаритарным протоколам CDP (CISCO Discovery Protocol) и NDP (Network Discovery Protocol).  
В Linux для работы с этим протоколом используется пакет `lldpd`. Информацию по соседям можно получить командой `lldpctl`.

### 3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.
*Ответ:*  
Технология VLAN (Virtual Local Area Network) позволяет создавать и гибко конфигурировать виртуальные сети поверх физической. Это позволяет реализовывать достаточно сложные сетевые конфигурации без покупки дополнительного оборудования и прокладки дополнительных кабелей.  
Для работы в Linux с VLAN необходимо загрузить модуль ядра: 8021q. Настроить виртуальную сеть с помощью:
- `vconfig` (находится либо в пакете `vlan` либо в пакете `vconfig`, в зависимости от дистрибутива Linux), настройка через `ifconfig`. Используется для создания временных виртуальных сетей которые существуют до перезапуска системы.
- пакет `Ifupdown`. Для настройки используются директивы расположенные в файле /etc/network/interfaces. Пример содержимого файла:
```
#interface loopback
auto lo
iface lo inet loopback
#Interface eth0 - untagged 
auto eth0
iface eth0 inet static
      address 192.168.10.10
      netmask 255.255.255.0
      gateway 192.168.10.1
      dns-nameservers 8.8.8.8
#Interface eth0.200 - tagged vlan 200
auto eth0.200
iface eth0.200 inet static
      address 192.168.8.10
      netmask 255.255.255.0
#Interface eth1 - untagged 
#auto eth1
#iface eth1 inet dhcp
```
- `netplan` - наиболее современный пакет. Файл для настройки сети находится в каталоге /etc/netplan/. Имя файла может быть любым, на конце должно быть расширение yaml, например:
чаще всего, это файл 50-cloud-init.yaml или 01-netcfg.yaml. Пример настройки:
```
network:
    version: 2
    renderer: networkd
    ethernets:
        ens3:
            dhcp4: true
        ens7:
            dhcp4: no
            addresses: [192.168.122.195/24]
            gateway4: 192.168.122.1
            mtu: 1500
            nameservers:
                addresses: [8.8.8.8, 77.88.8.8]
                search: [ dmosk.local ]
        ens9:
            dhcp4: no
            addresses: [192.168.1.10/24, 192.168.1.20/24]
            nameservers:
                addresses:
                    - 8.8.8.8
                    - 77.88.8.8
                search: [ dmosk.local, dmosk.ru ]
```

### 4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.
*Ответ:*  

Типы агрегации интерфейсов в Linux:
1. "balance-rr" - (round-robin) - режим циклического выбора активного интерфейса для исходящего трафика (рекомендован для включения по умолчанию, не требует применения специальных коммутаторов);
2. "active-backup" - активен только один интерфейс, остальные в режиме горячей замены (самый простой режим, работает с любым оборудованием, не требует применения специальных коммутаторов);
3. "balance-xor" - режим, в котором каждый получатель закрепляется за одним из физических интерфейсов, который выбирается по специальной формуле (не требует применения специальных коммутаторов);
4. "broadcast" - трафик идёт через все интерфейсы одновременно (примитивный и потенциально конфликтный режим);
5. "802.3ad" - (dynamic link aggregation) - в группу объединяются одинаковые по скорости и режиму интерфейсы. Все физические интерфейсы используются одновременно в соответствии со спецификацией IEEE 802.3ad. Для реализации этого режима необходима поддержка на уровне драйверов сетевых карт и коммутатор, поддерживающий стандарт IEEE 802.3ad (коммутатор требует отдельной настройки);
6. "balance-tlb" - (adaptive transmit load balancing) - исходящий трафик распределяется в соответствии с текущей нагрузкой (с учетом скорости) на интерфейсах (для данного режима необходима его поддержка в драйверах сетевых карт);
7. "balance-alb" - (adaptive load balancing) - включает в себя balance-tlb, плюс балансировку на приём (rlb) для IPv4 трафика и не требует применения специальных коммутаторов (балансировка на приём достигается на уровне протокола ARP, перехватом ARP ответов локальной системы и перезаписью физического адреса на адрес одного из сетевых интерфейсов, в зависимости от загрузки).  

`ifenslave` - утилита для настройки агрегирования.  
Пример настройки `netplan`:
```
network:
  version: 2
  renderer: networkd
  ethernets:
    eports:
      match:
        name: enp*
      optional: true
  bonds:
    bond0:
      interfaces: [eports]
      parameters:
        mode: 802.3ad
        lacp-rate: fast
        mii-monitor-interval: 100
  bridges:
    br0:
      dhcp6: no
      addresses: [ 10.20.30.250/29 ]
      gateway4: 10.20.30.249
      nameservers:
        search: [ example.net ]
        addresses:
          - "10.20.30.40"
      interfaces:
        - bond0
```

### 5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.
*Ответ:*  
* В сети с маской /29 - 8 адресов (остается 3 бита для кодирования хоста, 2 ^ 3 = 8)
* Из сети с маской /24 можно получить 32 подсети с маской /29 (остается 5 бит для кодирования подсетей уровня 29 от уровня 24, 2 ^ 5 = 32).
* Пример /29 подсетей внутри сети 10.10.10.0/24:
  * 10.10.10.0/29
  * 10.10.10.8/29
  * 10.10.10.16/29
  * 10.10.10.24/29
  * ...
  * 10.10.10.248/29

### 6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.
*Ответ:*  
40-50 хостов значит для адреса нужно оставить последние 6 бит (2^6 = 64)
значит маска подсети должна быть /26 (32-6)  
Использовать адреса будем из подсети 100.64.0.0/10
Итого: будем использовать адреса из подсети 100.64.0.0/26


### 7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?
*Ответ:*  

В Windows:
- `arp -a` - посмотерть ARP-таблицу
- `arp -d` или `netsh interface IP delete arpcache` - удалить всю таблицу ARP
- `arp -d <ip-address>` - удалить из таблицы ARP запись для IP-адреса <ip-address>

- В Linux:
- `ip neigh` или `arp -n` - посмотерть ARP-таблицу
- `ip -s -s neigh flush all` - удалить всю таблицу ARP
- `arp -d <ip-address>` - удалить из таблицы ARP запись для IP-адреса <ip-address>
